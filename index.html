<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#0a7cff">

<title>Calculadora EcoFlow</title>

<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Calculadora EcoFlow">

<style>
:root{
  --primary:#0a7cff;
  --card:#ffffff;
  --text:#1f2937;
  --muted:#6b7280;
  --success:#16a34a;
  --warning:#dc2626;
  --info:#0284c7;
}
body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont;
  background:linear-gradient(180deg,#eef3fb,#f9fbff);
  padding:18px;
  color:var(--text);
}
.app{max-width:1000px;margin:auto}
header{display:flex;gap:12px;margin-bottom:16px}
.logo{
  width:44px;height:44px;border-radius:12px;
  background:linear-gradient(135deg,var(--primary),#60a5fa);
  display:flex;align-items:center;justify-content:center;
  color:#fff;font-weight:700
}
h1{margin:0;font-size:20px}
.subtitle{font-size:13px;color:var(--muted)}
.card{
  background:var(--card);
  border-radius:20px;
  padding:20px;
  box-shadow:0 18px 40px rgba(0,0,0,.08);
  margin-bottom:16px;
}
label{font-size:13px;font-weight:600}
input,select{
  width:100%;padding:12px;border-radius:12px;
  border:1px solid #e5e7eb;font-size:14px;margin-top:6px
}
button{
  padding:14px;border-radius:14px;
  border:none;font-weight:600;font-size:14px;cursor:pointer
}
.primary{background:var(--primary);color:#fff}
.secondary{background:#eef2ff;color:var(--primary)}
.danger{background:#fee2e2;color:#991b1b}
.actions{display:flex;gap:10px;flex-wrap:wrap}

.toggle-card{
  display:flex;justify-content:space-between;align-items:center;
  padding:14px;border-radius:16px;border:1px solid #e5e7eb;
  background:#f9fbff;margin-top:12px;cursor:pointer
}
.toggle-left{display:flex;gap:12px;align-items:center}
.toggle-icon{
  width:40px;height:40px;border-radius:12px;
  background:linear-gradient(135deg,var(--primary),#60a5fa);
  display:flex;align-items:center;justify-content:center;
  color:white;font-size:18px
}
.switch{position:relative;width:46px;height:26px}
.switch input{opacity:0}
.slider{
  position:absolute;inset:0;background:#d1d5db;
  border-radius:999px;transition:.3s
}
.slider:before{
  content:"";position:absolute;height:20px;width:20px;
  left:3px;bottom:3px;background:#fff;
  border-radius:50%;transition:.3s
}
.switch input:checked + .slider{background:var(--primary)}
.switch input:checked + .slider:before{transform:translateX(20px)}

#tipoCargaSection{
  overflow:hidden;max-height:0;opacity:0;
  transition:max-height .35s ease, opacity .25s ease
}
#tipoCargaSection.show{max-height:360px;opacity:1}

.preset-row{display:flex;gap:8px;margin:8px 0}
.preset{
  flex:1;padding:8px;border-radius:12px;
  border:1px solid #e5e7eb;background:#f9fafb;font-size:13px
}
.preset.active{background:var(--primary);color:#fff}

.tooltip{font-size:12px;color:var(--muted)}
.result{font-size:14px;line-height:1.6}
.ok{color:var(--success);font-weight:600}
.warning{color:var(--warning);font-weight:600}
.info{color:var(--info);font-weight:600}

table th,table td{
  border:1px solid #e5e7eb;
  padding:6px;
  text-align:center;
  vertical-align:middle;
}
table th{background:#f1f5f9}
</style>
</head>

<body>
<div class="app">

<header>
  <div class="logo">EF</div>
  <div>
    <h1>Calculadora EcoFlow</h1>
    <div class="subtitle">Respaldo ‚Ä¢ Solar ‚Ä¢ Off-Grid</div>
  </div>
</header>

<!-- ================= CARGA AC ================= -->
<div class="card">
  <label>Carga continua promedio (W)</label>
  <input id="watts" type="number" placeholder="Ej. 2000">

  <!-- Tipo de carga -->
  <div class="toggle-card" onclick="toggleTipoCargaCard()">
    <div class="toggle-left">
      <div class="toggle-icon">‚ö°</div>
      <div>
        <b>Tipo de carga</b>
        <div class="subtitle">Opcional</div>
      </div>
    </div>
    <label class="switch">
      <input type="checkbox" id="activarTipoCarga" onchange="toggleTipoCarga()">
      <span class="slider"></span>
    </label>
  </div>

  <div id="tipoCargaSection">
    <div class="preset-row">
      <button class="preset" onclick="presetTipo('electronica',this)">üíª Electr√≥nica</button>
      <button class="preset" onclick="presetTipo('motor',this)">‚öôÔ∏è Motor</button>
      <button class="preset" onclick="presetTipo('resistiva',this)">üî• Resistiva</button>
    </div>

    <select id="tipoCarga">
      <option value="electronica">Electr√≥nica</option>
      <option value="motor">Motor</option>
      <option value="resistiva">Resistiva</option>
    </select>

    <!-- X-Boost -->
    <div id="xboostSection" style="display:none;margin-top:12px">
      <div class="toggle-card">
        <div class="toggle-left">
          <div class="toggle-icon">‚ö†Ô∏è</div>
          <div>
            <b>X-Boost</b>
            <div class="subtitle">Solo resistivo</div>
          </div>
        </div>
        <label class="switch">
          <input type="checkbox" id="usarXboost">
          <span class="slider"></span>
        </label>
      </div>
      <div class="tooltip">
        No incrementa potencia real. No usar con electr√≥nica sensible.
      </div>
    </div>
  </div>

  <div class="actions" style="margin-top:14px">
    <button class="secondary" onclick="toggleSolar()">‚òÄÔ∏è Modo Solar</button>
    <button class="danger" onclick="toggleOffGrid()">üèïÔ∏è Off-Grid total</button>
  </div>
</div>

<!-- ================= SOLAR (TABLA) ================= -->
<div id="solarSection" class="card" style="display:none;overflow-x:auto">
  <h3>Compatibilidad Solar EcoFlow</h3>
  <div class="tooltip">
    Comparativo de paneles solares vs equipos EcoFlow
  </div>

  <table style="width:100%;margin-top:12px;font-size:12px">
    <thead>
      <tr>
        <th>Panel</th>
        <th>River 3<br>245Wh</th>
        <th>River 3 Plus<br>286Wh</th>
        <th>River 3 Max<br>572Wh</th>
        <th>River 3 Max Plus<br>858Wh</th>
        <th>Delta 3<br>1024Wh</th>
        <th>Delta 2 Max<br>2048Wh</th>
        <th>Delta Pro<br>3600Wh</th>
        <th>Delta Pro 3<br>4096Wh</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>45W USB-C</td>
        <td class="ok">Compatible<br>Lento</td>
        <td class="ok">Compatible<br>Lento</td>
        <td class="ok">Muy lento</td>
        <td class="ok">Muy lento</td>
        <td class="warning">No recomendado</td>
        <td class="warning">No recomendado</td>
        <td class="warning">No recomendado</td>
        <td class="warning">No recomendado</td>
      </tr>
      <tr>
        <td>60W USB-C</td>
        <td class="ok">Compatible</td>
        <td class="ok">Compatible</td>
        <td class="ok">Muy lento</td>
        <td class="ok">Muy lento</td>
        <td class="warning">No recomendado</td>
        <td class="warning">No recomendado</td>
        <td class="warning">No recomendado</td>
        <td class="warning">No recomendado</td>
      </tr>
      <tr>
        <td>110W</td>
        <td class="ok">Ideal</td>
        <td class="ok">Ideal</td>
        <td class="ok">Compatible</td>
        <td class="ok">Muy lento</td>
        <td class="ok">Muy lento</td>
        <td class="warning">No recomendado</td>
        <td class="warning">No recomendado</td>
        <td class="warning">No recomendado</td>
      </tr>
      <tr>
        <td>160W</td>
        <td class="warning">No compatible</td>
        <td class="ok">Carga r√°pida</td>
        <td class="ok">Compatible</td>
        <td class="ok">Carga lenta</td>
        <td class="ok">Carga lenta</td>
        <td class="warning">No recomendado</td>
        <td class="warning">No recomendado</td>
        <td class="warning">No recomendado</td>
      </tr>
      <tr>
        <td>220W</td>
        <td class="warning">No compatible</td>
        <td class="ok">Carga r√°pida</td>
        <td class="ok">Carga r√°pida</td>
        <td class="ok">Compatible</td>
        <td class="ok">Compatible</td>
        <td class="ok">Muy lento</td>
        <td class="warning">No recomendado</td>
        <td class="warning">No recomendado</td>
      </tr>
      <tr>
        <td>400W</td>
        <td class="warning">No compatible</td>
        <td class="warning">No compatible</td>
        <td class="warning">No compatible</td>
        <td class="warning">No compatible</td>
        <td class="ok">Ideal</td>
        <td class="ok">Compatible</td>
        <td class="ok">Muy lento</td>
        <td class="ok">Muy lento</td>
      </tr>
      <tr>
        <td>400W √ó2</td>
        <td class="warning">No compatible</td>
        <td class="warning">No compatible</td>
        <td class="warning">No compatible</td>
        <td class="warning">No compatible</td>
        <td class="warning">No compatible</td>
        <td class="ok">Carga r√°pida</td>
        <td class="ok">Compatible</td>
        <td class="ok">Carga lenta</td>
      </tr>
      <tr>
        <td>400W √ó3</td>
        <td class="warning">No compatible</td>
        <td class="warning">No compatible</td>
        <td class="warning">No compatible</td>
        <td class="warning">No compatible</td>
        <td class="warning">No compatible</td>
        <td class="warning">No compatible</td>
        <td class="ok">Carga r√°pida</td>
        <td class="ok">Carga r√°pida</td>
      </tr>
    </tbody>
  </table>
</div>

<!-- ================= OFF-GRID ================= -->
<div id="offGridSection" class="card" style="display:none">
  <label>Horas sin sol (noche)</label>
  <input id="nightHours" type="number">
</div>

<div class="card">
  <button class="primary" onclick="calcular()">Calcular recomendaci√≥n</button>
  <div id="resultado" class="result"></div>
</div>

</div>

<script>
let solar=false,offgrid=false;

function toggleTipoCarga(){
  activarTipoCarga.checked
    ? (tipoCargaSection.classList.add('show'),
       tipoCargaSection.scrollIntoView({behavior:'smooth'}))
    : tipoCargaSection.classList.remove('show');
}
function toggleTipoCargaCard(){
  activarTipoCarga.checked=!activarTipoCarga.checked;
  toggleTipoCarga();
}
function presetTipo(tipo,btn){
  tipoCarga.value=tipo;
  document.querySelectorAll('.preset').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  xboostSection.style.display = tipo==='resistiva'?'block':'none';
  if(tipo!=='resistiva') usarXboost.checked=false;
}
function toggleSolar(){
  solar=!solar;
  solarSection.style.display=solar?'block':'none';
}
function toggleOffGrid(){
  offgrid=!offgrid;
  offGridSection.style.display=offgrid?'block':'none';
  if(offgrid && !solar) toggleSolar();
}

/* ================= C√ÅLCULO AC ================= */
function calcular(){
  const w=+watts.value;
  if(!w){
    resultado.innerHTML='<span class="warning">Ingresa una carga v√°lida</span>';
    return;
  }

  const equipos=[
    {n:'River 3',c:245,m:300},
    {n:'River 3 Plus',c:286,m:600},
    {n:'River 3 Max',c:572,m:600},
    {n:'Delta 3',c:1024,m:1800},
    {n:'Delta 2 Max',c:2048,m:2400},
    {n:'Delta Pro',c:3600,m:3600},
    {n:'Delta Pro 3',c:4096,m:3600}
  ];

  let compatibles=[],xboostSolo=[],recomendado=null;

  equipos.forEach(e=>{
    if(w<=e.m){
      const h=(e.c/w).toFixed(2);
      compatibles.push({ ...e,h });
      if(!recomendado && h>=2) recomendado=e;
    }
    if(
      activarTipoCarga.checked &&
      tipoCarga.value==='resistiva' &&
      usarXboost.checked
    ){
      const lim=e.m*1.3;
      if(w>e.m && w<=lim) xboostSolo.push(e.n);
    }
  });

  let html='<b>Equipos compatibles:</b><br><br>';
  if(compatibles.length){
    compatibles.forEach(e=>{
      html+=`‚Ä¢ ${e.n}: ${e.h} h<br>`;
    });
  }else{
    html+='<span class="warning">Ning√∫n equipo soporta esta carga directamente</span><br>';
  }

  html+=recomendado
    ? `<br><span class="ok">Recomendado: ${recomendado.n}</span>`
    : `<br><span class="warning">Sin recomendaci√≥n directa</span>`;

  if(xboostSolo.length){
    html+=`
      <br><br>
      <span class="info">‚ö†Ô∏è Equipos que podr√≠an operar con X-Boost</span><br>
      <small>
        ${xboostSolo.join(', ')}<br>
        Solo para cargas resistivas. No incrementa potencia real.
      </small>`;
  }

  resultado.innerHTML=html;
}

if('serviceWorker'in navigator){
  navigator.serviceWorker.register('service-worker.js');
}
</script>
</body>
</html>
